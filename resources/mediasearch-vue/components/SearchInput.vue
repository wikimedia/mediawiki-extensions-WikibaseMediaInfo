<template>
	<div class="wbmi-media-search-input">
		<div class="wbmi-media-search-input__input-wrapper">
			<input
				v-model="term"
				:placeholder="$i18n( 'searchbutton' )"
				class="wbmi-media-search-input__input"
				tabindex="0"
				aria-disabled="false"
				@keyup.enter="updateTerm"
			>

			<span class="wbmi-media-search-input__input-icon">
				<mw-icon :icon="icons.wbmiIconSearch"></mw-icon>
			</span>

			<span
				v-if="showIndicator"
				class="wbmi-media-search-input__input-clear"
				@click="clearInput"
			>
				<mw-icon :icon="icons.wbmiIconClear"></mw-icon>
			</span>
		</div>

		<mw-button
			class="wbmi-media-search-input__button"
			:primary="true"
			:progressive="true"
			@click="updateTerm">
			{{ $i18n( 'searchbutton' ) }}
		</mw-button>
	</div>
</template>

<script>
var icons = require( '../../../lib/icons.js' ),
	Button = require( './base/Button.vue' ),
	Icon = require( './base/Icon.vue' );

module.exports = {
	name: 'SearchInput',

	components: {
		'mw-button': Button,
		'mw-icon': Icon
	},

	props: {
		initialTerm: String
	},

	data: function () {
		return {
			term: this.initialTerm,
			icons: icons
		};
	},

	computed: {
		/**
		 * @return {boolean}
		 */
		showIndicator: function () {
			return this.term && this.term.length >= 1;
		}
	},

	methods: {
		/**
		 * @fires update event with term string as payload
		 */
		updateTerm: function () {
			this.$emit( 'update', this.term );
		},

		/**
		 * @fires clear
		 */
		clearInput: function () {
			this.term = '';
			this.$emit( 'clear' );
		}
	}
};
</script>

<style lang="less">
@import 'mediawiki.mixins';
@import '../../mediainfo-variables.less';

.wbmi-media-search-input {
	.flex-display();
	.flex-wrap( nowrap );
	box-sizing: border-box;
	max-width: @max-width-base;
	padding: 0 0 @wbmi-spacing-base 0;
	width: 100%;

	&__input-wrapper {
		align-self: stretch;
		position: relative;
		width: 100%;
	}

	&__input {
		border-radius: @border-radius-base 0 0 @border-radius-base;
		border: @border-style-base @border-width-base @border-color-base;
		box-sizing: border-box;
		font-size: 14px;
		height: 100%;
		margin: 0;
		padding-left: 36px;
		width: 100%;

		&:focus {
			border-color: @color-primary--focus;
			box-shadow: @box-shadow-base--focus;
			outline: 0;
		}

		&::placeholder {
			color: @color-placeholder;
		}
	}

	&__input-icon {
		.flex-display();
		flex-direction: column;
		height: 100%;
		justify-content: center;
		left: @wbmi-spacing-sm;
		position: absolute;
		top: 0;
	}

	&__input-clear {
		color: @wbmi-indicator-color;
		cursor: pointer;
		padding-right: @wbmi-padding-horizontal-input-text;
		position: absolute;
		right: 0;
		top: 50%;
		transform: translateY( -50% );

		.mw-icon {
			// Icon size is based on font size, so we'll set it here to make the
			// indicator smaller than the default font size.
			// Equal to 12px in ems.
			font-size: unit(
				@min-size-indicator / @wbmi-font-size-browser / @wbmi-font-size-base,
				em
			);
		}
	}

	&__button {
		border-radius: 0 @border-radius-base @border-radius-base 0;
		margin: 0;
	}

	// See: https://phabricator.wikimedia.org/T222283
	// This overrides an override in mediawiki.legacy/shared.css which keeps
	// this input element from flipping over to RTL orientation;
	// stylelint-disable-next-line selector-class-pattern
	body.rtl.sitedir-ltr & input {
		direction: unset;
	}
}
</style>
